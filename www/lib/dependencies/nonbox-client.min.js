!function(){"use strict";angular.module("nonbox-client",["ui.router"]);var t=angular.module("nonbox-client");t.run(["$rootScope",function(t){t.nbConnected=!1,t.nbServer="http://localhost:3000/",t.nbApi="https://api.nonbox.us/v1/companion/",t.$on("loading:start",function(){t.isLoading=!0}),t.$on("loading:finish",function(){t.isLoading=!1})}]),t.config(["$sceProvider","$httpProvider",function(t,e){e.defaults.headers.get||(e.defaults.headers.get={"Cache-Control":"no-cache",Pragma:"no-cache"}),t.enabled(!1),e.interceptors.push(["$q","$rootScope",function(t,e){return{request:function(n){return e.$broadcast("loading:start"),n||t.when(n)},response:function(n){return e.$broadcast("loading:finish"),n||t.when(n)},responseError:function(n){return e.$broadcast("loading:finish"),t.reject(n)}}}])}]),t.config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,e,n){e.state("devices",{url:"/",templateUrl:templateDir+"/devices.html",controller:"DevicesCtrl"}).state("device",{url:"/device/:serial",templateUrl:templateDir+"/device.html",controller:"DeviceCtrl"}).state("networks",{url:"/networks",templateUrl:templateDir+"/networks.html",controller:"WifiCtrl"}).state("quickstart",{url:"/quickstart",templateUrl:templateDir+"/quickstart.html"}).state("tutorials",{url:"/tutorials",templateUrl:templateDir+"/tutorials.html",controller:["$scope","Tutorials",function(t,e){t.showMode=!1,e.then(function(e){t.tutorials=e}),t.show=function(e){t.showMode=!0,t.tutorial=e}}]}).state("support",{url:"/support",templateUrl:templateDir+"/support.html"}).state("bugs",{url:"/bugs",templateUrl:templateDir+"/bugreport.html",controller:"ReportsCtrl"}).state("suggestions",{url:"/suggestions",templateUrl:templateDir+"/suggestion.html",controller:"ReportsCtrl"}).state("pr",{url:"/pr",templateUrl:templateDir+"/pr.html"}),n.otherwise("/")}]),t.controller("DeviceCtrl",["$scope","$rootScope","Nonbox","Wifi","$stateParams",function(t,e,n,o,r){console.log(r.serial),t.check=function(){n.check().then(function(r){e.nbConnected=r,r?n.info().then(function(e){t.info=e,o.status()}):t.$broadcast("nonbox.notfound")}).catch(function(n){e.nbConnected=n,t.$broadcast("nonbox.notfound")}).finally(function(){t.$broadcast("scroll.refreshComplete")})},t.removeDevice=function(e,o){t.$broadcast("device:remove"),n.removeDevice(e).then(function(e){e&&(t.info.devices.splice(o,1),t.$broadcast("device:removed"))})},t.check()}]),t.controller("DevicesCtrl",["$scope","$window","$rootScope","Device","$injector",function(t,e,n,o,r){function c(){o.all().then(function(e){t.devices=e}).finally(function(){t.$broadcast("scroll.refreshComplete")})}t.devices=[],t.device={};var i;t.preventSpace=function(t){32===t.keyCode&&t.preventDefault()},t.$on("$ionicView.enter",function(e){r.get("$ionicModal").fromTemplateUrl("templates/serial.html",{scope:t}).then(function(e){t.modal=e}),c()}),t.removeDevice=function(t){(i=r.get("$ionicPopup").confirm({title:"Remove Device",template:"Are you sure you want to remove this device?",cancelText:"Cancel",cancelType:"button-default",okText:"Remove",okType:"button-assertive"})).then(function(e){e&&(o.remove(t),c())})},t.saveDevice=function(e){o.findOrCreate(e).then(function(e){c(),t.modal.hide()})},t.setCurrent=function(t){o.setCurrent(t).then(function(t){console.log(JSON.stringify(t))})},t.listDevices=function(){c()},c()}]),t.controller("ReportsCtrl",["$state","$scope","Report",function(t,e,n){e.message={},e.submit=function(o){n.submit(o,t.current.name).then(function(t){200==t.status?e.message={text:"Thanks! We'll take a look.",icon:"check",color:"green"}:e.message={text:"Error submitting. Check internet connection.",color:"red"}}).catch(function(t){e.message={text:"Error submitting. Check internet connection.",color:"red"}}),e.$apply}}]),t.controller("WifiCtrl",["$injector","$scope","$state","$timeout","Nonbox","Wifi",function(t,e,n,o,r,c){function i(n){var o=document.getElementById("passwordDialog");if(null!=o)"open"===n&&o.showModal(),"close"===n&&o.close();else{if("close"===n)return;t.get("$ionicPopup").show({template:'<input type="password" ng-model="currentAp.password">',title:"Connect to "+e.currentAp.ssid,scope:e,buttons:[{text:"Cancel"},{text:"Connect",type:"button-dark",onTap:function(t){e.currentAp.password?e.secureConnect(e.currentAp):t.preventDefault()}}]})}}e.connectSecure=!1,e.currentAp={},e.networks=[],e.error="",e.status="",e.colorStrength=function(t){return"rgba(253,188,64,"+(t>80?.01*t:.01*(t-15))+")"},e.connect=function(t){e.currentAp=t,t.security?i("open"):(c.connect(t).then(function(t){}),e.scan())},e.secureConnect=function(t){i("close"),c.connect(t).then(function(t){delete e.currentAp.password,console.log(t.status),500===t.status?i("open"):e.scan()})},e.cancelConnect=function(t){i("close")},e.disconnect=function(){c.disconnect().then(function(t){e.scan()})},e.reset=function(){c.reset().then(function(t){e.scan()})},e.scan=function(){c.status().then(function(t){1==t.success?e.current=t:e.current={ssid:!1}}),c.scan().then(function(t){t.data&&1==t.data.success?e.networks=t.data.networks.filter(function(t){return"nonbox"!==t.ssid}):t.data&&(e.error=t.data.msg)}).catch(function(t){n.go("device")}).finally(function(){e.$broadcast("scroll.refreshComplete")})},e.$on("$ionicView.enter",function(){e.scan()}),e.scan()}]),t.service("Nonbox",["$rootScope","$http",function(t,e){return{check:function(){return e.get(t.nbServer,{timeout:7e3}).then(function(t){return 200===t.status&&"nonbox server"===t.data}).catch(function(t){return!1})},info:function(){return e.get(t.nbServer+"info").then(function(t){if(200===t.status)return t.data}).catch(function(t){return t})},removeDevice:function(n){return e.post(t.nbServer+"device",n).then(function(t){if(console.log(t),200===t.status)return t.data}).catch(function(t){return t})}}}]),t.service("Report",["$rootScope","$http",function(t,e){return{submit:function(n,o){return e.post(t.nbApi+"report/"+o,n).then(function(t){return t},function(t){return t}).catch(function(t){return t})}}}]),t.service("Tutorials",["$http","$rootScope",function(t,e){return t.get(e.nbApi+"tutorials").then(function(t){return console.log(t),t.status,t.data}).catch(function(t){})}]),t.service("Wifi",["$rootScope","$http",function(t,e){return{scan:function(){return e.get(t.nbServer+"scan",{timeout:5e3}).then(function(t){return t}).catch(function(t){return t})},connect:function(n){return e.post(t.nbServer+"connect",{ap:n}).then(function(t){return t}).catch(function(t){return t})},status:function(){return e.get(t.nbServer+"status",{timeout:5e3}).then(function(e){return t.online=e.data.success,e.data}).catch(function(e){return t.online=!1,e})},disconnect:function(){return e.delete(t.nbServer+"disconnect").then(function(e){return t.online=!1,e}).catch(function(t){return t})},reset:function(){return e.delete(t.nbServer+"reset",{timeout:7e3}).then(function(e){return t.online=e.data.success,e.data}).catch(function(e){return t.online=!1,e})}}}])}();