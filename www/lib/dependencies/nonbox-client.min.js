!function(){"use strict";angular.module("nonbox-client",["ui.router"]);var t=angular.module("nonbox-client");t.run(["$rootScope",function(t){t.nbConnected=!1,t.nbServer="http://localhost:3000/",t.nbApi="http://localhost:9000/v1/companion/",t.$on("loading:start",function(){t.isLoading=!0}),t.$on("loading:finish",function(){t.isLoading=!1})}]),t.config(["$sceProvider","$httpProvider",function(t,n){n.defaults.headers.get||(n.defaults.headers.get={"Cache-Control":"no-cache",Pragma:"no-cache"}),t.enabled(!1),n.interceptors.push(["$q","$rootScope",function(t,n){return{request:function(e){return n.$broadcast("loading:start"),e||t.when(e)},response:function(e){return n.$broadcast("loading:finish"),e||t.when(e)},responseError:function(e){return n.$broadcast("loading:finish"),t.reject(e)}}}])}]),t.config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,n,e){n.state("device",{url:"/",templateUrl:templateDir+"/device.html",controller:"DeviceCtrl"}).state("networks",{url:"/networks",templateUrl:templateDir+"/networks.html",controller:"WifiCtrl"}).state("quickstart",{url:"/quickstart",templateUrl:templateDir+"/quickstart.html"}).state("tutorials",{url:"/tutorials",templateUrl:templateDir+"/tutorials.html",controller:["$scope","Tutorials",function(t,n){t.showMode=!1,n.then(function(n){t.tutorials=n}),t.show=function(n){t.showMode=!0,t.tutorial=n}}]}).state("support",{url:"/support",templateUrl:templateDir+"/support.html"}).state("bugs",{url:"/bugs",templateUrl:templateDir+"/bugreport.html",controller:"ReportsCtrl"}).state("suggestions",{url:"/suggestions",templateUrl:templateDir+"/suggestion.html",controller:"ReportsCtrl"}).state("pr",{url:"/pr",templateUrl:templateDir+"/pr.html"}),e.otherwise("/")}]),t.controller("DeviceCtrl",["$scope","$rootScope","Nonbox","Wifi",function(t,n,e,o){t.check=function(){e.check().then(function(r){n.nbConnected=r,r?e.info().then(function(n){t.info=n,o.status()}):t.$broadcast("nonbox.notfound")}).catch(function(e){n.nbConnected=e,t.$broadcast("nonbox.notfound")}).finally(function(){t.$broadcast("scroll.refreshComplete")})},t.removeDevice=function(n,o){t.$broadcast("device:remove"),e.removeDevice(n).then(function(n){n&&(t.info.devices.splice(o,1),t.$broadcast("device:removed"))})},t.check()}]),t.controller("ReportsCtrl",["$state","$scope","Report",function(t,n,e){n.message={},n.submit=function(o){e.submit(o,t.current.name).then(function(t){200==t.status?n.message={text:"Thanks! We'll take a look.",icon:"check",color:"green"}:n.message={text:"Error submitting. Check internet connection.",color:"red"}}).catch(function(t){n.message={text:"Error submitting. Check internet connection.",color:"red"}}),n.$apply}}]),t.controller("WifiCtrl",["$injector","$scope","$state","$timeout","Nonbox","Wifi",function(t,n,e,o,r,c){function i(e){var o=document.getElementById("passwordDialog");if(null!=o)"open"===e&&o.showModal(),"close"===e&&o.close();else{if("close"===e)return;t.get("$ionicPopup").show({template:'<input type="password" ng-model="currentAp.password">',title:"Connect to "+n.currentAp.ssid,scope:n,buttons:[{text:"Cancel"},{text:"Connect",type:"button-dark",onTap:function(t){n.currentAp.password?n.secureConnect(n.currentAp):t.preventDefault()}}]})}}n.connectSecure=!1,n.currentAp={},n.networks=[],n.error="",n.status="",n.colorStrength=function(t){return"rgba(253,188,64,"+(t>80?.01*t:.01*(t-15))+")"},n.connect=function(t){n.currentAp=t,t.security?i("open"):(c.connect(t).then(function(t){}),n.scan())},n.secureConnect=function(t){i("close"),c.connect(t).then(function(t){delete n.currentAp.password,console.log(t.status),500===t.status?i("open"):n.scan()})},n.cancelConnect=function(t){i("close")},n.disconnect=function(){c.disconnect().then(function(t){n.scan()})},n.reset=function(){c.reset().then(function(t){n.scan()})},n.scan=function(){c.status().then(function(t){1==t.success?n.current=t:n.current={ssid:!1}}),c.scan().then(function(t){t.data&&1==t.data.success?n.networks=t.data.networks.filter(function(t){return"nonbox"!==t.ssid}):t.data&&(n.error=t.data.msg)}).catch(function(t){e.go("device")}).finally(function(){n.$broadcast("scroll.refreshComplete")})},n.$on("$ionicView.enter",function(){n.scan()}),n.scan()}]),t.service("Nonbox",["$rootScope","$http",function(t,n){return{check:function(){return n.get(t.nbServer,{timeout:7e3}).then(function(t){return 200===t.status&&"nonbox server"===t.data}).catch(function(t){return!1})},info:function(){return n.get(t.nbServer+"info").then(function(t){if(200===t.status)return t.data}).catch(function(t){return t})},removeDevice:function(e){return n.post(t.nbServer+"device",e).then(function(t){if(console.log(t),200===t.status)return t.data}).catch(function(t){return t})}}}]),t.service("Report",["$rootScope","$http",function(t,n){return{submit:function(e,o){return n.post(t.nbApi+"report/"+o,e).then(function(t){return t},function(t){return t}).catch(function(t){return t})}}}]),t.service("Tutorials",["$http","$rootScope",function(t,n){return t.get(n.nbApi+"tutorials").then(function(t){return console.log(t),t.status,t.data}).catch(function(t){})}]),t.service("Wifi",["$rootScope","$http",function(t,n){return{scan:function(){return n.get(t.nbServer+"scan",{timeout:5e3}).then(function(t){return t}).catch(function(t){return t})},connect:function(e){return n.post(t.nbServer+"connect",{ap:e}).then(function(t){return t}).catch(function(t){return t})},status:function(){return n.get(t.nbServer+"status",{timeout:5e3}).then(function(n){return t.online=n.data.success,n.data}).catch(function(n){return t.online=!1,n})},disconnect:function(){return n.delete(t.nbServer+"disconnect").then(function(n){return t.online=!1,n}).catch(function(t){return t})},reset:function(){return n.delete(t.nbServer+"reset",{timeout:7e3}).then(function(n){return t.online=n.data.success,n.data}).catch(function(n){return t.online=!1,n})}}}])}();